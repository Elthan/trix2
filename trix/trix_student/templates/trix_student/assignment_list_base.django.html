{% extends "trix_student/base.django.html" %}
{% load i18n %}
{% load trix_core_tags %}

{% block title %}{% trans "Assignments" %}{% endblock title %}

{% block body %}
    {% block pageheader %}
    {% endblock pageheader %}
    {# Enable popover #}
    <script>
        $(function () {
            $('[data-toggle="popover"]').popover()
        })
    </script>
    <div class="container">
        <div class="trix-assignment-container">
            <div class="trix-sticky">
                <div id="assignments-taggingbox" class="trix-no-print">
                    {% if authenticated %}
                    <div ng-controller="AssignmentListProgressController"
                         class="trix-user-level-progress"
                         ng-hide="hideProgress"
                         ng-cloak>
                        <div class="trix-user-level-text">
                            <p>{% trans "Level" %}
                            {% verbatim %}{{ level }}{% endverbatim %}
                            </p>
                            <a href="#" data-toggle="popover"
                                data-placement="left"
                                data-trigger="focus"
                                data-title="{{ level_explanation_header }}"
                                data-content="{{ level_explanation_text }}">
                                <i class="far fa-question-circle"></i>
                            </a>
                        </div>
                        {% verbatim %}
                        <div class="progress">
                            <div class="progress-bar bg-success"
                                 role="progressbar"
                                 aria-valuenow="{{ level_progress }}"
                                 aria-valuemin="0"
                                 aria-valuemax="100"
                                 style="width: {{ level_progress }}%; color: #333;">
                                {{ experience }}xp
                            </div>
                        </div>
                        {% endverbatim %}
                    </div>
                    <div ng-controller="AssignmentListProgressController"
                            class="assignments-progressbox"
                            ng-hide="hideProgress"
                            ng-cloak>
                        <div ng-show="loading">
                            <span class="fa fa-spin fa-spinner"></span>
                            <span class="sr-only">{% trans "Loading progress..." %}</span>
                        </div>
                        <div ng-show="!loading">
                            {% verbatim %}
                                <div class="progress">
                                    <div class="progress-bar"
                                         ng-class="progressBarClass"
                                         role="progressbar"
                                         aria-valuenow="{{ solvedPercentage }}"
                                         aria-valuemin="0"
                                         aria-valuemax="100"
                                         style="width: {{ solvedPercentage }}%;">
                                        {{ solvedPercentage }}%
                                    </div>
                                </div>
                            {% endverbatim %}
                            <p class="text-muted">
                                <small>
                                    {{ progresstext }}
                                </small>
                            </p>
                        </div>
                    </div>
                    {% endif %}
                    <div ng-controller="RemoveTagCtrl" class="assignments-selectedtags-listing">
                        <h3>{% trans "Selected tags" %}:</h3>
                        {% for tag in non_removeable_tags %}
                            <button type="button" class="btn btn-primary btn-sm disabled">{{ tag }}</button>
                        {% endfor %}
                        {% if selected_tags %}
                            {% for tag in selected_tags %}
                                <button type="button" class="btn btn-sm
                                    {% if tag|startswith:'-' %}trix-btn-neg{% else %}btn-primary{% endif %}"
                                        ng-click="removeTag('{{ tag }}')">
                                    {{ tag }}
                                    <span class="fa fa-times"></span>
                                </button>
                            {% endfor %}
                        {% endif %}
                    </div>
                    {% if selectable_tags %}
                        <form ng-controller="AddTagCtrl" class="trix-no-print">
                            <h3>{% trans "Filter" %}:</h3>
                            <div class="trix-neg">
                                <label>{% trans "Filter out" %}:</label>
                                <input type="checkbox" ng-model="negative">
                            </div>
                            <select ng-model="tagToAdd" ng-change="addTag()">
                                <option value="" selected>-- {% trans "Select a tag" %} --</option>
                                {% for tag in selectable_tags %}
                                    <option value="{{ tag }}">{{ tag }}</option>
                                {% endfor %}
                            </select>
                        </form>
                    {% endif %}
                    <div class="trix-no-print">
                        <h3>{% trans "Print" %}:</h3>
                        <button class="btn btn-default" onclick="window.print()">
                            <span class="fa fa-print"></span>
                            {% trans "Print this page" %}
                        </button>
                    </div>
                </div>
            </div>
            <div class="trix-assignment-list" ng-controller="AssignmentListController"
                ng-init="{% if course %}course_id={{ course.id }}{% endif %};
                        {% if request.GET.no_filter != None %}no_filter=true{% endif %}">
                {# {% include "trix_student/include/pager.django.html" with pager_extraclass="pager-no-topmargin hidden-xs" %} #}
                {# Angular directive located in the directive.coffee file. Loads all the assignmnets. #}
                <trix-assignment-list />
                {# {% include "trix_student/include/pager.django.html" %} #}
            </div>
        </div>
    </div>
{% endblock body %}
